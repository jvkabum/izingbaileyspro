(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"9e67":function(i,a,o){"use strict";o.r(a);var s=function(){var i=this,a=i._self._c;return"super"===i.userProfile?a("div",[a("q-table",{staticClass:"my-sticky-dynamic q-ma-lg",attrs:{title:"Usuarios",data:i.usuarios,columns:i.columns,loading:i.loading,"row-key":"id",pagination:i.pagination,"virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,"rows-per-page-options":[0]},on:{"update:pagination":function(a){i.pagination=a},"virtual-scroll":i.onScroll},scopedSlots:i._u([{key:"top-right",fn:function(){return[a("q-input",{staticClass:"col-grow",staticStyle:{width:"300px"},attrs:{outlined:"",rounded:"",dense:"",debounce:"500",clearable:"",placeholder:"Localize"},on:{input:i.filtrarUsuario},scopedSlots:i._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!1,2901929698),model:{value:i.filter,callback:function(a){i.filter=a},expression:"filter"}}),a("q-btn",{staticClass:"q-ml-md col",class:{"q-ml-none q-mt-md q-mr-md":i.$q.screen.width<500},attrs:{rounded:"",color:"primary",label:"Adicionar"},on:{click:function(a){i.usuarioSelecionado={},i.modalUsuario=!0}}})]},proxy:!0},{key:"body-cell-acoes",fn:function(o){return[a("q-td",{staticClass:"text-center"},[a("q-btn",{attrs:{flat:"",round:"",icon:"edit"},on:{click:function(a){return i.editarUsuario(o.row)}}})],1)]}},{key:"pagination",fn:function({pagination:a}){return[i._v("\n      "+i._s(i.usuarios.length)+"/"+i._s(a.rowsNumber)+"\n    ")]}}],null,!1,3703888791)}),a("ModalUsuario",{attrs:{modalUsuario:i.modalUsuario,usuarioEdicao:i.usuarioSelecionado},on:{"update:modalUsuario":function(a){i.modalUsuario=a},"update:modal-usuario":function(a){i.modalUsuario=a},"modalUsuario:usuario-editado":i.UPDATE_USUARIO,"modalUsuario:usuario-criado":i.usuarioCriado,"update:usuarioEdicao":function(a){i.usuarioSelecionado=a},"update:usuario-edicao":function(a){i.usuarioSelecionado=a}}}),a("ModalUsuarioEdit",{attrs:{modalUsuario:i.modalUsuarioEdit,usuarioEdicao:i.usuarioSelecionado},on:{"update:modalUsuario":function(a){i.modalUsuarioEdit=a},"update:modal-usuario":function(a){i.modalUsuarioEdit=a},"modalUsuario:usuario-editado":i.UPDATE_USUARIO,"update:usuarioEdicao":function(a){i.usuarioSelecionado=a},"update:usuario-edicao":function(a){i.usuarioSelecionado=a}}})],1):i._e()},e=[],t=(o("14d9"),o("9a1b")),r=function(){var i=this,a=i._self._c;return a("q-dialog",{attrs:{persistent:"",value:i.modalUsuario},on:{hide:i.fecharModal,show:i.abrirModal}},[a("q-card",{staticStyle:{width:"600px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[i._v("Cadastrar Usuário")])]),a("q-card-section",{staticClass:"q-col-gutter-sm"},[a("div",{staticClass:"row q-col-gutter-sm"},[a("div",{staticClass:"col-12"},[a("c-input",{attrs:{outlined:"",validator:i.$v.usuario.name,label:"Nome"},on:{blur:i.$v.usuario.name.$touch},model:{value:i.usuario.name,callback:function(a){i.$set(i.usuario,"name","string"===typeof a?a.trim():a)},expression:"usuario.name"}})],1),a("div",{staticClass:"col-12"},[a("c-input",{attrs:{outlined:"",validator:i.$v.usuario.email,label:"E-mail"},on:{blur:i.$v.usuario.email.$touch},model:{value:i.usuario.email,callback:function(a){i.$set(i.usuario,"email","string"===typeof a?a.trim():a)},expression:"usuario.email"}})],1)]),a("div",{staticClass:"row q-col-gutter-sm"},[a("div",{staticClass:"col-12"},[a("c-input",{attrs:{outlined:"",validator:i.$v.usuario.password,type:i.isPwd?"password":"text",label:"Senha"},on:{blur:i.$v.usuario.password.$touch},scopedSlots:i._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:i.isPwd?"visibility_off":"visibility"},on:{click:function(a){i.isPwd=!i.isPwd}}})]},proxy:!0}]),model:{value:i.usuario.password,callback:function(a){i.$set(i.usuario,"password",a)},expression:"usuario.password"}})],1),a("div",{staticClass:"col-12"},[a("q-select",{attrs:{disable:i.isProfile,outlined:"",rounded:"",dense:"",options:i.optionsProfile,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Perfil"},model:{value:i.usuario.profile,callback:function(a){i.$set(i.usuario,"profile",a)},expression:"usuario.profile"}})],1)])]),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md q-mr-sm",attrs:{rounded:"",label:"Sair",color:"negative"}}),a("q-btn",{staticClass:"q-px-md",attrs:{rounded:"",label:"Salvar",color:"primary"},on:{click:i.handleUsuario}})],1)],1)],1)},u=[],l=o("b5ae"),n={name:"ModalUsuario",props:{modalUsuario:{type:Boolean,default:!1},isProfile:{type:Boolean,default:!1},usuarioEdicao:{type:Object,default:()=>({id:null})}},data(){return{isPwd:!1,optionsProfile:[{value:"user",label:"Usuário"},{value:"admin",label:"Administrador"}],usuario:{name:"",email:"",password:"",profile:"user"}}},validations(){let i={name:{required:l["required"],minLength:Object(l["minLength"])(3),maxLength:Object(l["maxLength"])(50)},email:{required:l["required"],email:l["email"]},profile:{required:l["required"]},password:{}};return this.usuario.id||(i={...i,password:{required:l["required"],minLength:Object(l["minLength"])(6),maxLength:Object(l["maxLength"])(50)}}),{usuario:i}},methods:{abrirModal(){this.usuarioEdicao.id&&(this.usuario={...this.usuarioEdicao}),this.usuarioEdicao.userId&&(this.usuario={...this.usuarioEdicao,id:this.usuarioEdicao.userId,name:this.usuarioEdicao.username,profile:this.usuarioEdicao.profile})},fecharModal(){this.isProfile||this.$emit("update:usuarioEdicao",{}),this.$emit("update:modalUsuario",!1),this.usuario={name:"",email:"",password:"",profile:"user"},this.isPwd=!1,this.$v.usuario.$reset()},async handleUsuario(){if(this.$v.usuario.$touch(),this.$v.usuario.$error)return this.$q.notify({type:"warning",progress:!0,position:"top",message:"Ops! Verifique os erros...",actions:[{icon:"close",round:!0,color:"white"}]});try{if(this.usuario.id){const{email:i,id:a,name:o,tenantId:s,password:e}=this.usuario,r={email:i,id:a,name:o,tenantId:s,password:e};this.$store.state.user.isAdmin&&(r.profile=this.usuario.profile);const{data:u}=await Object(t["b"])(this.usuario.id,r);this.$emit("modalUsuario:usuario-editado",u),this.$root.$emit("usuario-editado",u),this.$q.notify({type:"info",progress:!0,position:"top",textColor:"black",message:"Usuário editado!",actions:[{icon:"close",round:!0,color:"white"}]})}this.$emit("update:modalUsuario",!1)}catch(i){console.error(i),"ERR_USER_LIMIT_USER_CREATION"===i.data.error?this.$q.notify({type:"negative",message:"Limite de usuario atingido.",caption:"ERR_USER_LIMIT_USER_CREATION",position:"top",progress:!0}):"ERR_EMAIL_ALREADY_REGISTERED"===i.data.error?this.$q.notify({type:"negative",message:"Este e-mail já está cadastrado.",caption:"ERR_EMAIL_ALREADY_REGISTERED",position:"top",progress:!0}):this.$q.notify({type:"negative",message:"Não foi possível alterar o usuário.",caption:"ERR_UNKNOWN_ERROR",position:"top",progress:!0})}}}},d=n,c=o("2877"),p=o("24e8"),m=o("f09f"),h=o("a370"),f=o("0016"),v=o("ddd8"),b=o("4b7e"),g=o("9c40"),E=o("7f67"),U=o("eebe"),q=o.n(U),w=Object(c["a"])(d,r,u,!1,null,"6f98ad51",null),$=w.exports;q()(w,"components",{QDialog:p["a"],QCard:m["a"],QCardSection:h["a"],QIcon:f["a"],QSelect:v["a"],QCardActions:b["a"],QBtn:g["a"]}),q()(w,"directives",{ClosePopup:E["a"]});var y=function(){var i=this,a=i._self._c;return a("q-dialog",{attrs:{persistent:"",value:i.modalUsuario},on:{hide:i.fecharModal,show:i.abrirModal}},[a("q-card",{staticStyle:{width:"600px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[i._v("Cadastrar Usuário")])]),a("q-card-section",{staticClass:"q-col-gutter-sm"},[a("div",{staticClass:"row q-col-gutter-sm"},[a("div",{staticClass:"col-12"},[a("q-select",{attrs:{outlined:"",rounded:"",dense:"",options:i.filteredTenants,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Empresa"},model:{value:i.usuario.tenantId,callback:function(a){i.$set(i.usuario,"tenantId",a)},expression:"usuario.tenantId"}})],1)]),a("div",{staticClass:"row q-col-gutter-sm"},[a("div",{staticClass:"col-12"},[a("c-input",{attrs:{outlined:"",validator:i.$v.usuario.name,label:"Nome"},on:{blur:i.$v.usuario.name.$touch},model:{value:i.usuario.name,callback:function(a){i.$set(i.usuario,"name","string"===typeof a?a.trim():a)},expression:"usuario.name"}})],1),a("div",{staticClass:"col-12"},[a("c-input",{attrs:{outlined:"",validator:i.$v.usuario.email,label:"E-mail"},on:{blur:i.$v.usuario.email.$touch},model:{value:i.usuario.email,callback:function(a){i.$set(i.usuario,"email","string"===typeof a?a.trim():a)},expression:"usuario.email"}})],1)]),a("div",{staticClass:"row q-col-gutter-sm"},[a("div",{staticClass:"col-12"},[a("c-input",{attrs:{outlined:"",validator:i.$v.usuario.password,type:i.isPwd?"password":"text",label:"Senha"},on:{blur:i.$v.usuario.password.$touch},scopedSlots:i._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:i.isPwd?"visibility_off":"visibility"},on:{click:function(a){i.isPwd=!i.isPwd}}})]},proxy:!0}]),model:{value:i.usuario.password,callback:function(a){i.$set(i.usuario,"password",a)},expression:"usuario.password"}})],1),a("div",{staticClass:"col-12"},[a("q-select",{attrs:{disable:i.isProfile,outlined:"",rounded:"",dense:"",options:i.optionsProfile,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Perfil"},model:{value:i.usuario.profile,callback:function(a){i.$set(i.usuario,"profile",a)},expression:"usuario.profile"}})],1)])]),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md q-mr-sm",attrs:{rounded:"",label:"Sair",color:"negative"}}),a("q-btn",{staticClass:"q-px-md",attrs:{rounded:"",label:"Salvar",color:"primary"},on:{click:i.handleUsuario}})],1)],1)],1)},R=[],_=o("6320"),I={name:"ModalUsuario",props:{modalUsuario:{type:Boolean,default:!1},isProfile:{type:Boolean,default:!1},usuarioEdicao:{type:Object,default:()=>({id:null})}},data(){return{tenants:[],isPwd:!1,optionsProfile:[{value:"admin",label:"Administrador"},{value:"user",label:"Usuário"}],usuario:{name:"",email:"",password:"",profile:"user",tenantId:""}}},validations(){let i={tenantId:{required:l["required"]},name:{required:l["required"],minLength:Object(l["minLength"])(3),maxLength:Object(l["maxLength"])(50)},email:{required:l["required"],email:l["email"]},profile:{required:l["required"]},password:{}};return this.usuario.id||(i={...i,password:{required:l["required"],minLength:Object(l["minLength"])(6),maxLength:Object(l["maxLength"])(50)}}),{usuario:i}},created(){this.AdminListarEmpresas()},computed:{filteredTenants(){return this.tenants.map((i=>({label:i.name,value:i.id})))}},methods:{async AdminListarEmpresas(){const{data:i}=await Object(_["a"])();this.tenants=i},abrirModal(){this.usuarioEdicao.id&&(this.usuario={...this.usuarioEdicao}),this.usuarioEdicao.userId&&(this.usuario={...this.usuarioEdicao,id:this.usuarioEdicao.userId,name:this.usuarioEdicao.username,profile:this.usuarioEdicao.profile,tenantId:this.usuarioEdicao.tenantId})},fecharModal(){this.isProfile||this.$emit("update:usuarioEdicao",{}),this.$emit("update:modalUsuario",!1),this.usuario={name:"",email:"",password:"",profile:"user",tenantId:""},this.isPwd=!1,this.$v.usuario.$reset()},async handleUsuario(){if(this.$v.usuario.$touch(),this.$v.usuario.$error)return this.$q.notify({type:"warning",progress:!0,position:"top",message:"Ops! Verifique os erros...",actions:[{icon:"close",round:!0,color:"white"}]});try{if(this.usuario.id){const{email:i,id:a,name:o,tenantId:s,password:e,profile:t}=this.usuario,r={email:i,id:a,name:o,tenantId:s,password:e,profile:t};this.$store.state.user.isAdmin&&(r.profile=this.usuario.profile),this.$emit("modalUsuario:usuario-editado",r),this.$q.notify({type:"info",progress:!0,position:"top",textColor:"black",message:"Usuário editado!",actions:[{icon:"close",round:!0,color:"white"}]})}else{const{data:i}=await Object(t["d"])(this.usuario);this.$emit("modalUsuario:usuario-criado",i),this.$root.$emit("usuario-criado",i),this.$q.notify({type:"positive",progress:!0,position:"top",message:"Usuário criado!",actions:[{icon:"close",round:!0,color:"white"}]})}this.$emit("update:modalUsuario",!1)}catch(i){console.error(i),"ERR_USER_LIMIT_USER_CREATION"===i.data.error?this.$q.notify({type:"negative",message:"Limite de usuario atingido.",caption:"ERR_USER_LIMIT_USER_CREATION",position:"top",progress:!0}):"ERR_EMAIL_ALREADY_REGISTERED"===i.data.error?this.$q.notify({type:"negative",message:"Este e-mail já está cadastrado.",caption:"ERR_EMAIL_ALREADY_REGISTERED",position:"top",progress:!0}):this.$q.notify({type:"negative",message:"Não foi possível criar o usuário.",caption:"ERR_UNKNOWN_ERROR",position:"top",progress:!0})}}}},S=I,C=Object(c["a"])(S,y,R,!1,null,"ca7e9f98",null),x=C.exports;q()(C,"components",{QDialog:p["a"],QCard:m["a"],QCardSection:h["a"],QSelect:v["a"],QIcon:f["a"],QCardActions:b["a"],QBtn:g["a"]}),q()(C,"directives",{ClosePopup:E["a"]});var P={name:"IndexUsuarios",components:{ModalUsuario:x,ModalUsuarioEdit:$},data(){return{userProfile:"user",usuarios:[],usuarioSelecionado:{},filas:[],optionsProfile:[{value:"user",label:"Usuário"},{value:"admin",label:"Administrador"},{value:"super",label:"Super"}],modalUsuario:!1,modalUsuarioEdit:!1,filter:null,pagination:{rowsPerPage:40,rowsNumber:0,lastIndex:0},params:{pageNumber:1,searchParam:null,hasMore:!0},loading:!1,columns:[{name:"tenantId",label:"Empresa",field:"tenant",align:"left",format:i=>`${i.id} - ${i.name}`},{name:"id",label:"ID",field:"id",align:"left"},{name:"name",label:"Nome",field:"name",align:"left"},{name:"email",label:"E-mail",field:"email",align:"left"},{name:"profile",label:"Perfil",field:"profile",align:"left",format:i=>this.optionsProfile.find((a=>a.value==i)).label},{name:"acoes",label:"Ações",field:"acoes",align:"center"}]}},methods:{LOAD_USUARIOS(i){const a=[];i.forEach((i=>{const o=this.usuarios.findIndex((a=>a.id===i.id));-1!==o?this.usuarios[o]=i:a.push(i)}));const o=[...this.usuarios,...a];this.usuarios=o.filter((i=>"super"!==i.profile))},UPDATE_USUARIO(i){let a=[...this.usuarios];const o=a.findIndex((a=>a.id===i.id));-1!==o?a[o]=i:a=[i,...a],this.usuarios=[...a]},DELETE_USUARIO(i){const a=[...this.usuarios.filter((a=>a.id!==i))];this.usuarios=[...a]},async listarUsuarios(){this.loading=!0;const{data:i}=await Object(t["a"])(this.params);this.usuarios=i.users,this.LOAD_USUARIOS(i.users),this.params.hasMore=i.hasMore,this.pagination.lastIndex=this.usuarios.length-1,this.pagination.rowsNumber=i.count,this.loading=!1},filtrarUsuario(i){this.usuarios=[],this.params.pageNumber=1,this.params.searchParam=i,this.listarUsuarios()},onScroll({to:i,ref:a,...o}){!0!==this.loading&&!0===this.params.hasMore&&i===this.pagination.lastIndex&&(this.params.pageNumber++,this.listarUsuarios())},usuarioCriado(i){this.usuarios.push(i),this.listarUsuarios()},editarUsuario(i){this.usuarioSelecionado=i,this.modalUsuarioEdit=!0}},async mounted(){await this.listarUsuarios(),this.userProfile=localStorage.getItem("profile"),this.$root.$on("usuario-editado",(()=>{this.listarUsuarios()}))}},A=P,L=(o("cc8d"),o("eaac")),O=o("27f9"),k=o("db86"),M=Object(c["a"])(A,s,e,!1,null,null,null);a["default"]=M.exports;q()(M,"components",{QTable:L["a"],QInput:O["a"],QIcon:f["a"],QBtn:g["a"],QTd:k["a"]})},cc8d:function(i,a,o){"use strict";o("ccf7")},ccf7:function(i,a,o){}}]);