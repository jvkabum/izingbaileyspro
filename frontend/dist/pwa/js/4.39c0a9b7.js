(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{3113:function(t,a,e){},5533:function(t,a,e){"use strict";e("3113")},e090:function(t,a,e){"use strict";e.r(a);e("14d9");var o=function(){var t=this,a=t._self._c;return a("div",[a("q-table",{staticClass:"my-sticky-dynamic",class:{"q-ma-lg":!t.isChatContact,"q-ml-md heightChat":t.isChatContact},attrs:{title:"Contatos",id:"tabela-contatos-"+(t.isChatContact?"atendimento":""),data:t.contacts,columns:t.columns,loading:t.loading,"row-key":"id","virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,pagination:t.pagination,"rows-per-page-options":[0],bordered:t.isChatContact,square:t.isChatContact,flat:t.isChatContact,separator:t.isChatContact?"vertical":"horizontal"},on:{"update:pagination":function(a){t.pagination=a},"virtual-scroll":t.onScroll},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticClass:"row col-2 q-table__title items-center"},[t.isChatContact?a("q-btn",{staticClass:"q-mr-sm",attrs:{color:"black",round:"",flat:"",icon:"mdi-close"},on:{click:function(a){return t.$router.push({name:"chat-empty"})}}}):t._e(),t._v("\n        Contatos\n      ")],1),a("q-space"),a("q-input",{class:{"order-last q-mt-md":t.$q.screen.width<500},staticStyle:{width:"300px"},attrs:{dense:"",outlined:"",rounded:"",debounce:"500",clearable:"",placeholder:"Localize"},on:{input:t.filtrarContato},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(a){t.filter=a},expression:"filter"}}),a("q-space"),a("q-btn-dropdown",{staticClass:"glossy",attrs:{color:"primary",label:"Adicionar",rounded:"",split:""},on:{click:function(a){t.selectedContactId=null,t.modalContato=!0}}},[a("q-list",{attrs:{separator:""}},[a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.confirmarSincronizarContatos}},[a("q-item-section",[a("q-item-label",[t._v("Importar do Whatsapp")])],1)],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(a){t.modalImportarContatos=!0}}},[a("q-item-section",[a("q-item-label",[t._v("Importar .CSV")])],1)],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.handleExportContacts}},[a("q-item-section",[a("q-item-label",[t._v("Exportar")])],1)],1)],1)],1)]},proxy:!0},{key:"body-cell-profilePicUrl",fn:function(e){return[a("q-td",[a("q-avatar",{staticStyle:{border:"1px solid #9e9e9ea1 !important"}},[e.value?t._e():a("q-icon",{attrs:{name:"mdi-account",size:"1.5em",color:"grey-5"}}),a("q-img",{staticStyle:{"max-width":"150px"},attrs:{src:e.value},scopedSlots:t._u([{key:"error",fn:function(){return[a("q-icon",{attrs:{name:"mdi-account",size:"1.5em",color:"grey-5"}})]},proxy:!0}],null,!0)})],1)],1)]}},{key:"body-cell-acoes",fn:function(e){return[a("q-td",{staticClass:"text-center"},[e.row.number?a("q-btn",{attrs:{flat:"",round:"",icon:"img:whatsapp-logo.png"},on:{click:function(a){return t.handleSaveTicket(e.row,"whatsapp")}}}):t._e(),e.row.instagramPK?a("q-btn",{attrs:{flat:"",round:"",icon:"img:instagram-logo.png"},on:{click:function(a){return t.handleSaveTicket(e.row,"instagram")}}}):t._e(),e.row.telegramId?a("q-btn",{attrs:{flat:"",round:"",icon:"img:telegram-logo.png"},on:{click:function(a){return t.handleSaveTicket(e.row,"telegram")}}}):t._e(),a("q-btn",{attrs:{flat:"",round:"",icon:"edit"},on:{click:function(a){return t.editContact(e.row.id)}}}),a("q-btn",{attrs:{flat:"",round:"",icon:"mdi-delete"},on:{click:function(a){return t.deleteContact(e.row.id)}}})],1)]}},{key:"pagination",fn:function({pagination:a}){return[t._v("\n      "+t._s(t.contacts.length)+"/"+t._s(a.rowsNumber)+"\n    ")]}}])}),a("ContatoModal",{attrs:{contactId:t.selectedContactId,modalContato:t.modalContato},on:{"update:modalContato":function(a){t.modalContato=a},"update:modal-contato":function(a){t.modalContato=a},"contatoModal:contato-editado":t.UPDATE_CONTACTS,"contatoModal:contato-criado":t.UPDATE_CONTACTS}}),a("q-dialog",{attrs:{persistent:"",position:"top"},on:{show:t.abrirEnvioArquivo},model:{value:t.modalImportarContatos,callback:function(a){t.modalImportarContatos=a},expression:"modalImportarContatos"}},[a("q-card",{staticStyle:{width:"400px"}},[a("q-card-section",{staticClass:"row items-center"},[a("div",{staticClass:"text-h6"},[t._v("Selecione o arquivo")])]),a("q-card-section",[a("q-file",{ref:"PickerFileMessage",attrs:{id:"PickerFileMessage",outlined:"",dense:"",rounded:"","use-chips":"",accept:".csv",label:"Arquivo de contatos",hint:"Colunas: Nome; Numero"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"cloud_upload"}})]},proxy:!0}]),model:{value:t.file,callback:function(a){t.file=a},expression:"file"}})],1),a("q-card-section",{staticClass:"row q-gutter-sm"},[a("div",{staticClass:"col-12"},[a("q-select",{staticClass:"full-width",attrs:{outlined:"",dense:"",rounded:"",multiple:"",label:"Etiquetas",options:t.etiquetas,"use-chips":"","option-value":"id","option-label":"tag","emit-value":"","map-options":""},scopedSlots:t._u([{key:"option",fn:function({itemProps:e,itemEvents:o,opt:i,selected:n,toggleOption:s}){return[a("q-item",t._g(t._b({},"q-item",e,!1),o),[a("q-item-section",[a("q-item-label",{domProps:{innerHTML:t._s(i.tag)}})],1),a("q-item-section",{attrs:{side:""}},[a("q-checkbox",{attrs:{value:n},on:{input:function(t){return s(i)}}})],1)],1)]}},{key:"selected-item",fn:function({opt:e}){return[a("q-chip",{staticClass:"q-ma-xs row col-12 text-body1",attrs:{dense:"",square:"",color:"white","text-color":"primary"}},[a("q-icon",{staticClass:"q-mr-sm",style:`color: ${e.color}`,attrs:{name:"mdi-pound-box-outline",size:"28px"}}),t._v("\n                "+t._s(e.tag)+"\n              ")],1)]}},{key:"no-option",fn:function({itemProps:e,itemEvents:o}){return[a("q-item",t._g(t._b({},"q-item",e,!1),o),[a("q-item-section",[a("q-item-label",{staticClass:"text-negative text-bold"},[t._v("\n                    Ops... Sem etiquetas criadas!\n                  ")]),a("q-item-label",{attrs:{caption:""}},[t._v("\n                    Cadastre novas etiquetas na administração de sistemas.\n                  ")])],1)],1)]}}]),model:{value:t.tags,callback:function(a){t.tags=a},expression:"tags"}})],1),a("div",{staticClass:"col-12"},[a("q-select",{staticClass:"full-width",attrs:{outlined:"",dense:"",rounded:"",multiple:"","max-values":1,options:t.usuarios,"use-chips":"",label:"Carteira","option-value":"id","option-label":"name","emit-value":"","map-options":""},model:{value:t.wallets,callback:function(a){t.wallets=a},expression:"wallets"}})],1)]),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-ml-md",attrs:{color:"negative",label:"Cancelar",rounded:""},on:{click:function(a){t.isImportCSV=!1,t.modalImportarContatos=!1}}}),a("q-btn",{staticClass:"q-ml-md",attrs:{color:"positive",label:"Confirmar",rounded:""},on:{click:t.handleImportCSV}}),a("q-btn",{staticClass:"q-ml-md",attrs:{color:"primary",label:"Baixar Modelo",rounded:""},on:{click:t.downloadModelCsv}})],1)],1)],1)],1)},i=[],n=e("c5bd"),s=e("73ad"),r=e("006a"),l=e("9a1b"),c=e("163e"),d=e("2f62");const m=+localStorage.getItem("userId");var p={name:"IndexContatos",components:{ContatoModal:r["a"]},userProfile:"user",usuario:{},props:{isChatContact:{type:Boolean,default:!1}},computed:{...Object(d["b"])(["whatsapps"])},data(){return{contacts:[],modalImportarContatos:!1,modalContato:!1,file:[],isImportCSV:!1,filter:null,selectedContactId:null,params:{pageNumber:1,searchParam:null,hasMore:!0},wallets:[],tags:[],etiquetas:[],usuarios:[],pagination:{rowsPerPage:100,rowsNumber:0,lastIndex:0},loading:!1,columns:[{name:"profilePicUrl",label:"",field:"profilePicUrl",style:"width: 50px",align:"center"},{name:"name",label:"Nome",field:"name",align:"left",style:"width: 300px",format:(t,a)=>a.number&&a.name==a.number&&a.pushname?a.pushname:a.name},{name:"number",label:"WhatsApp",field:"number",align:"center",style:"width: 300px"},{name:"wallet",label:"Carteira",field:"wallet",align:"center",style:"width: 300px"},{name:"instagramPK",label:"Instagram",field:"instagramPK",align:"center",style:"width: 300px",format:(t,a)=>a.instagramPK?a.pushname:""},{name:"telegramId",label:"Id Telegram",field:"telegramId",align:"center",style:"width: 300px",format:(t,a)=>a.telegramId?a.pushname:""},{name:"email",label:"Email",field:"email",style:"width: 500px",align:"left"},{name:"acoes",label:"Ações",field:"acoes",align:"center"}]}},methods:{downloadModelCsv(){const t="nome;numero\nCliente;5511999999999",a=new Blob([t],{type:"text/csv"}),e=document.createElement("a");e.href=window.URL.createObjectURL(a),e.setAttribute("download","modelo.csv"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},abrirEnvioArquivo(t){this.isImportCSV=!0,this.$refs.PickerFileMessage.pickFiles(t)},async handleImportCSV(){try{this.$q.notify({type:"warning",message:"Isso pode demorar um pouco.",caption:"Após finalizar, a página será atualizada.",position:"top"});const t=new FormData;t.append("file",this.file),this.tags.length>0&&t.append("tags",this.tags),this.wallets.length>0&&t.append("wallets",this.wallets),await Object(s["g"])(t),this.$notificarSucesso("Contatos importados com sucesso!"),this.$router.go(0)}catch(t){this.$notificarErro(t)}},async listarUsuarios(){try{const{data:t}=await Object(l["f"])();this.usuarios=t.users}catch(t){console.error(t),this.$notificarErro("Problema ao carregar usuários",t)}},async listarEtiquetas(){const{data:t}=await Object(c["d"])(!0);this.etiquetas=t},downloadFile(t){const a=document.createElement("a");a.href=t,a.setAttribute("download","contatos.xlsx"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},handleExportContacts(){Object(s["f"])().then((t=>{const a=t.data.downloadLink;this.downloadFile(a)})).catch((t=>{console.error("Erro ao exportar contatos:",t)}))},LOAD_CONTACTS(t){const a=[];t.forEach((t=>{const e=this.contacts.findIndex((a=>a.id===t.id));-1!==e?this.contacts[e]=t:a.push(t)}));const e=[...this.contacts,...a];this.contacts=e},UPDATE_CONTACTS(t){const a=[...this.contacts],e=a.findIndex((a=>a.id===t.id));-1!==e?a[e]=t:a.unshift(t),this.contacts=[...a]},DELETE_CONTACT(t){const a=[...this.contacts],e=a.findIndex((a=>a.id===t));-1!==e&&a.splice(e,1),this.contacts=[...a]},filtrarContato(t){this.contacts=[],this.params.pageNumber=1,this.params.searchParam=t,this.loading=!0,this.listarContatos()},async listarContatos(){this.loading=!0;const{data:t}=await Object(s["h"])(this.params);this.params.hasMore=t.hasMore,this.LOAD_CONTACTS(t.contacts),this.loading=!1,this.pagination.lastIndex=this.contacts.length-1,this.pagination.rowsNumber=t.count},onScroll({to:t,ref:a,...e}){!0!==this.loading&&!0===this.params.hasMore&&t===this.pagination.lastIndex&&(this.loading=!0,this.params.pageNumber++,this.listarContatos())},async handleSaveTicket(t,a){if(!t.id)return;const e=[],o=null;this.whatsapps.forEach((t=>{t.type===a&&e.push({label:t.name,value:t.id})})),this.$q.dialog({title:`Contato: ${t.name}`,message:"Selecione o canal para iniciar o atendimento.",options:{type:"radio",model:o,isValid:t=>!!t,items:e},ok:{push:!0,rounded:!0,color:"positive",label:"Iniciar"},cancel:{push:!0,rounded:!0,label:"Cancelar",color:"negative"},persistent:!0}).onOk((async e=>{if(e){this.loading=!0;try{const{data:o}=await Object(n["f"])({contactId:t.id,isActiveDemand:!0,userId:m,channel:a,channelId:e,status:"open"});await this.$store.commit("SET_HAS_MORE",!0),await this.$store.dispatch("AbrirChatMensagens",o),this.$q.notify({message:`Atendimento Iniciado || ${o.contact.name} - Ticket: ${o.id}`,type:"positive",position:"top",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}),this.$router.push({name:"chat",params:{ticketId:o.id}})}catch(o){if(409===o.status){const a=JSON.parse(o.data.error);return void this.abrirAtendimentoExistente(t,a)}this.$notificarErro("Ocorreu um erro!",o)}this.loading=!1}}))},editContact(t){this.selectedContactId=t,this.modalContato=!0},deleteContact(t){this.$q.dialog({title:"Atenção!! Deseja realmente deletar o contato? ",cancel:{label:"Não",color:"primary",rounded:!0,push:!0},ok:{label:"Sim",color:"negative",rounded:!0,push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(s["b"])(t).then((a=>{this.DELETE_CONTACT(t),this.$q.notify({type:"positive",progress:!0,position:"top",message:"Contato deletado!",actions:[{icon:"close",round:!0,color:"white"}]})})).catch((t=>{console.error(t),this.$notificarErro("Não é possível deletar o contato",t)})),this.loading=!1}))},abrirChatContato(t){this.$q.screen.lt.md&&"pending"!==t.status&&this.$root.$emit("infor-cabecalo-chat:acao-menu"),"pending"===t.status||t.id===this.$store.getters.ticketFocado.id&&"chat"===this.$route.name||(this.$store.commit("SET_HAS_MORE",!0),this.$store.dispatch("AbrirChatMensagens",t))},abrirAtendimentoExistente(t,a){this.$q.dialog({title:"Atenção!!",message:`${t.name} possui um atendimento em curso (Atendimento: ${a.id}). Deseja abrir o atendimento?`,cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((async()=>{try{this.abrirChatContato(a)}catch(t){this.$notificarErro("Não foi possível atualizar o token",t)}}))},confirmarSincronizarContatos(){this.$q.dialog({title:"Atenção!! Deseja realmente sincronizar os contatos? ",message:"Todas os contatos com os quais você já conversou pelo Whatsapp serão criados. Isso pode demorar um pouco...",cancel:{label:"Não",rounded:!0,color:"primary",push:!0},ok:{label:"Sim",rounded:!0,color:"warning",push:!0},persistent:!0}).onOk((async()=>{this.loading=!0,await this.sincronizarContatos(),this.loading=!1}))},async sincronizarContatos(){try{this.loading=!0,await Object(s["j"])(),this.$q.notify({type:"info",progress:!0,position:"top",textColor:"black",message:"Contatos estão sendo atualizados. Isso pode levar um tempo...",actions:[{icon:"close",round:!0,color:"white"}]})}catch(t){console.error(t),this.$notificarErro("Ocorreu um erro ao sincronizar os contatos",t),this.loading=!0}this.loading=!0}},mounted(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.userProfile=localStorage.getItem("profile"),this.listarContatos(),this.listarUsuarios(),this.listarEtiquetas()}},u=p,h=(e("5533"),e("2877")),g=e("eaac"),f=e("9c40"),C=e("2c91"),b=e("27f9"),q=e("0016"),v=e("f20b"),w=e("1c1c"),y=e("66e5"),k=e("4074"),x=e("0170"),I=e("db86"),S=e("cb32"),_=e("068f"),E=e("24e8"),A=e("f09f"),$=e("a370"),O=e("7d53"),T=e("ddd8"),N=e("8f8e"),P=e("b047"),Q=e("4b7e"),M=e("7f67"),z=e("eebe"),j=e.n(z),D=Object(h["a"])(u,o,i,!1,null,null,null);a["default"]=D.exports;j()(D,"components",{QTable:g["a"],QBtn:f["a"],QSpace:C["a"],QInput:b["a"],QIcon:q["a"],QBtnDropdown:v["a"],QList:w["a"],QItem:y["a"],QItemSection:k["a"],QItemLabel:x["a"],QTd:I["a"],QAvatar:S["a"],QImg:_["a"],QDialog:E["a"],QCard:A["a"],QCardSection:$["a"],QFile:O["a"],QSelect:T["a"],QCheckbox:N["a"],QChip:P["a"],QCardActions:Q["a"]}),j()(D,"directives",{ClosePopup:M["a"]})}}]);