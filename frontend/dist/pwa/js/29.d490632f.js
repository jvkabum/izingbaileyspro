(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[29],{c124:function(a,t,e){"use strict";e.r(t);var s=function(){var a=this,t=a._self._c;return"admin"===a.userProfile?t("div",[t("div",{staticClass:"row col full-width q-pa-sm"},[t("q-card",{staticClass:"full-width",attrs:{flat:""}},[t("q-card-section",{staticClass:"text-h6 text-bold"},[a._v("\n        Canais\n        "),t("div",{staticClass:"absolute-right q-pa-md"},[t("q-btn",{attrs:{rounded:"",color:"black",icon:"mdi-plus",label:"Adicionar"},on:{click:function(t){a.modalWhatsapp=!0}}})],1)])],1)],1),t("div",{staticClass:"row full-width"},[a._l(a.canais,(function(e){return[t("q-card",{key:e.id,staticClass:"col-xs-12 col-sm-5 col-md-4 col-lg-3 q-ma-sm",attrs:{flat:"",bordered:""}},[t("q-item",[t("q-item-section",{attrs:{avatar:""}},[t("q-avatar",[t("q-icon",{attrs:{size:"40px",name:`img:${e.type}-logo.png`}})],1)],1),t("q-item-section",[t("q-item-label",{staticClass:"text-h6 text-bold"},[a._v("Nome: "+a._s(e.name))]),t("q-item-label",{staticClass:"text-h6 text-caption"},[a._v("\n              "+a._s(e.type)+"\n            ")])],1),t("q-item-section",{attrs:{side:""}},[a.isAdmin?t("q-btn",{attrs:{round:"",flat:"",dense:"",icon:"mdi-pen"},on:{click:function(t){return a.handleOpenModalWhatsapp(e)}}}):a._e()],1)],1),t("q-separator"),t("q-card-section",[t("ItemStatusChannel",{attrs:{item:e}}),"messenger"===e.type?[t("div",{staticClass:"text-body2 text-bold q-mt-sm"},[t("span",[a._v(" Página: ")]),a._v("\n              "+a._s(e.fbObject&&e.fbObject.name||"Nenhuma página configurada.")+"\n            ")])]:a._e()],2),t("q-card-section",[t("q-select",{attrs:{outlined:"",dense:"",rounded:"",label:"Bot",options:a.listaChatFlow,"map-options":"","emit-value":"","option-value":"id","option-label":"name",clearable:""},on:{input:function(t){return a.handleSaveWhatsApp(e)}},model:{value:e.chatFlowId,callback:function(t){a.$set(e,"chatFlowId",t)},expression:"item.chatFlowId"}})],1),t("q-separator"),t("q-card-actions",{staticClass:"q-gutter-md q-pa-md q-pt-none",attrs:{align:"center"}},["messenger"!==e.type?["whatsapp"==e.type&&"qrcode"==e.status?t("q-btn",{attrs:{rounded:"",color:"blue-5",label:"QR Code","icon-right":"watch_later",disable:!a.isAdmin},on:{click:function(t){return a.handleOpenQrModal(e,"btn-qrCode")}}}):a._e(),"DISCONNECTED"==e.status?t("div",{staticClass:"q-gutter-sm"},[t("q-btn",{attrs:{rounded:"",color:"positive",label:"Conectar"},on:{click:function(t){return a.handleStartWhatsAppSession(e.id)}}}),"DISCONNECTED"==e.status&&"whatsapp"==e.type?t("q-btn",{attrs:{rounded:"",color:"blue-5",label:"Novo QR Code","icon-right":"watch_later",disable:!a.isAdmin},on:{click:function(t){return a.handleRequestNewQrCode(e,"btn-qrCode")}}}):a._e()],1):a._e(),"OPENING"==e.status?t("div",{staticClass:"row items-center q-gutter-sm flex flex-inline"},[t("div",{staticClass:"text-bold"},[a._v("\n                Conectando\n              ")]),t("q-spinner-radio",{attrs:{color:"positive",size:"2em"}}),t("q-separator",{attrs:{vertical:"",spaced:""}})],1):a._e(),["OPENING","CONNECTED","PAIRING","TIMEOUT"].includes(e.status)?t("q-btn",{staticClass:"q-mx-sm",attrs:{color:"negative",label:"Desconectar",disable:!a.isAdmin},on:{click:function(t){return a.handleDisconectWhatsSession(e.id)}}}):a._e()]:a._e(),t("q-btn",{staticClass:"absolute-bottom-right",attrs:{color:"red",icon:"mdi-delete",disable:!a.isAdmin,dense:"",round:"",flat:""},on:{click:function(t){return a.deleteWhatsapp(e)}}},[t("q-tooltip",[a._v("\n              Deletar conexáo\n            ")])],1)],2)],1)]}))],2),t("ModalQrCode",{attrs:{abrirModalQR:a.abrirModalQR,channel:a.cDadosWhatsappSelecionado},on:{"update:abrirModalQR":function(t){a.abrirModalQR=t},"update:abrir-modal-q-r":function(t){a.abrirModalQR=t},"gerar-novo-qrcode":t=>a.handleRequestNewQrCode(t,"btn-qrCode")}}),t("ModalWhatsapp",{attrs:{modalWhatsapp:a.modalWhatsapp,whatsAppEdit:a.whatsappSelecionado},on:{"update:modalWhatsapp":function(t){a.modalWhatsapp=t},"update:modal-whatsapp":function(t){a.modalWhatsapp=t},"update:whatsAppEdit":function(t){a.whatsappSelecionado=t},"update:whats-app-edit":function(t){a.whatsappSelecionado=t},"recarregar-lista":a.listarWhatsapps}}),t("q-inner-loading",{attrs:{showing:a.loading}},[t("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1):a._e()},i=[],o=e("5c26"),n=e("b166"),l=e("e3ee"),r=e("d9d6"),c=e.n(r),d=function(){var a=this,t=a._self._c;return t("q-dialog",{attrs:{value:a.abrirModalQR,persistent:""},on:{hide:a.fecharModalQrModal}},[t("q-card",{staticStyle:{}},[t("q-card-section",[t("div",{staticClass:"text-h6 text-primary"},[a._v("\n        Leia o QrCode para iniciar a sessão\n        "),t("q-btn",{staticClass:"q-ml-md",attrs:{round:"",color:"negative",icon:"mdi-close"},on:{click:a.fecharModalQrModal}})],1)]),t("q-card-section",{staticClass:"text-center",style:a.$q.dark.isActive?"background: white !important":""},[a.cQrcode?t("QrcodeVue",{attrs:{value:a.cQrcode,size:300,level:"H"}}):t("span",[a._v("\n        Aguardando o Qr Code\n      ")])],1),t("q-card-section",[t("div",{staticClass:"row"},[a._v("Caso tenha problema com a leitura, solicite um novo Qr Code ")]),t("div",{staticClass:"row col-12 justify-center"},[t("q-btn",{attrs:{color:"primary",glossy:"",ripple:"",outline:"",label:"Novo QR Code",icon:"watch_later"},on:{click:a.solicitarQrCode}})],1)])],1)],1)},p=[],h=e("d7b0"),m={name:"ModalQrCode",components:{QrcodeVue:h["a"]},props:{abrirModalQR:{type:Boolean,default:!1},channel:{type:Object,default:()=>({id:null,qrcode:""})}},watch:{channel:{handler(a){"CONNECTED"===this.channel.status&&this.fecharModalQrModal()},deep:!0}},computed:{cQrcode(){return this.channel.qrcode}},methods:{solicitarQrCode(){this.$emit("gerar-novo-qrcode",this.channel),this.fecharModalQrModal()},fecharModalQrModal(){this.$emit("update:abrirModalQR",!1)}}},u=m,g=e("2877"),b=e("24e8"),w=e("f09f"),f=e("a370"),v=e("9c40"),q=e("eebe"),C=e.n(q),y=Object(g["a"])(u,d,p,!1,null,"132f6904",null),S=y.exports;C()(y,"components",{QDialog:b["a"],QCard:w["a"],QCardSection:f["a"],QBtn:v["a"]});var Q=e("2f62"),_=function(){var a=this,t=a._self._c;return t("q-dialog",{attrs:{value:a.modalWhatsapp,persistent:""},on:{hide:a.fecharModal,show:a.abrirModal}},[t("q-card",{staticClass:"q-pa-md",staticStyle:{width:"500px"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[t("q-icon",{staticClass:"q-mr-md",attrs:{size:"50px",name:a.whatsapp.type?`img:${a.whatsapp.type}-logo.png`:"mdi-alert"}}),a._v(" "+a._s(a.whatsapp.id?"Editar":"Adicionar")+"\n        Canal\n      ")],1)]),t("q-card-section",[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 q-my-sm"},[t("q-select",{attrs:{disable:!!a.whatsapp.id,options:a.optionsWhatsappsTypes,label:"Tipo","emit-value":"","map-options":"",outlined:"",rounded:"",dense:""},model:{value:a.whatsapp.type,callback:function(t){a.$set(a.whatsapp,"type",t)},expression:"whatsapp.type"}})],1),t("div",{staticClass:"col-12"},[t("c-input",{attrs:{outlined:"",rounded:"",label:"Nome",dense:"",validator:a.$v.whatsapp.name},on:{blur:a.$v.whatsapp.name.$touch},model:{value:a.whatsapp.name,callback:function(t){a.$set(a.whatsapp,"name",t)},expression:"whatsapp.name"}})],1),"telegram"===a.whatsapp.type?t("div",{staticClass:"col-12 q-mt-md"},[t("c-input",{attrs:{outlined:"",dense:"",label:"Token Telegram"},model:{value:a.whatsapp.tokenTelegram,callback:function(t){a.$set(a.whatsapp,"tokenTelegram",t)},expression:"whatsapp.tokenTelegram"}})],1):a._e(),"instagram"===a.whatsapp.type?t("div",{staticClass:"q-mt-md row full-width justify-center"},[t("div",{staticClass:"col"},[t("fieldset",{staticClass:"full-width q-pa-md rounded-all"},[t("legend",[a._v("Dados da conta do Instagram")]),"instagram"===a.whatsapp.type?t("div",{staticClass:"col-12 q-mb-md"},[t("c-input",{attrs:{outlined:"",dense:"",label:"Usuário",hint:"Seu usuário do Instagram (sem @)"},model:{value:a.whatsapp.instagramUser,callback:function(t){a.$set(a.whatsapp,"instagramUser",t)},expression:"whatsapp.instagramUser"}})],1):a._e(),"instagram"!==a.whatsapp.type||a.isEdit?a._e():t("div",{staticClass:"text-center"},[t("q-btn",{attrs:{color:"positive",icon:"edit",label:"Nova senha"},on:{click:function(t){a.isEdit=!a.isEdit}}},[t("q-tooltip",[a._v("\n                    Alterar senha\n                  ")])],1)],1),"instagram"===a.whatsapp.type&&a.isEdit?t("div",{staticClass:"col-12"},[t("c-input",{attrs:{outlined:"",rounded:"",label:"Senha",type:a.isPwd?"password":"text",hint:"Senha utilizada para logar no Instagram",placeholder:"*************",disable:!a.isEdit},scopedSlots:a._u([{key:"after",fn:function(){return[t("q-btn",{staticClass:"bg-padrao",attrs:{round:"",flat:"",color:"negative",icon:"mdi-close"},on:{click:function(t){a.isEdit=!a.isEdit}}},[t("q-tooltip",[a._v("\n                        Cancelar alteração de senha\n                      ")])],1)]},proxy:!0},{key:"append",fn:function(){return[t("q-icon",{staticClass:"cursor-pointer",attrs:{name:a.isPwd?"visibility_off":"visibility"},on:{click:function(t){a.isPwd=!a.isPwd}}})]},proxy:!0}],null,!1,4120386499),model:{value:a.whatsapp.instagramKey,callback:function(t){a.$set(a.whatsapp,"instagramKey",t)},expression:"whatsapp.instagramKey"}})],1):a._e()])])]):a._e()]),t("div",{staticClass:"row q-my-md"},[t("div",{staticClass:"col-12 relative-position"},[t("label",{staticClass:"text-caption"},[a._v("Mensagem Despedida:\n          ")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.whatsapp.farewellMessage,expression:"whatsapp.farewellMessage"}],ref:"inputFarewellMessage",staticClass:"q-pa-sm rounded-all bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:a.whatsapp.farewellMessage},on:{input:function(t){t.target.composing||a.$set(a.whatsapp,"farewellMessage",t.target.value)}}}),t("div",{staticClass:"absolute-top-right"},[t("q-btn",{staticStyle:{"margin-bottom":"-120px","margin-right":"-30px"},attrs:{rounded:"",dense:"",color:"black"}},[t("q-icon",{attrs:{size:"1.5em",name:"mdi-emoticon-happy-outline"}}),t("q-tooltip",[a._v("\n              Emoji\n            ")]),t("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[t("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:20,labelSearch:"Localizar...",lang:"pt-BR"},on:{select:a.onInsertSelectEmoji}})],1)],1),t("q-btn",{staticStyle:{"margin-bottom":"-40px","margin-right":"-10px"},attrs:{rounded:"",dense:"",color:"black"}},[t("q-icon",{attrs:{size:"1.5em",name:"mdi-variable"}}),t("q-tooltip",[a._v("\n                Variáveis\n              ")]),t("q-menu",{attrs:{"touch-position":""}},[t("q-list",{staticStyle:{"min-width":"100px"},attrs:{dense:""}},a._l(a.variaveis,(function(e){return t("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:e.label,attrs:{clickable:""},on:{click:function(t){return a.onInsertSelectVariable(e.value)}}},[t("q-item-section",[a._v(a._s(e.label))])],1)})),1)],1)],1)],1)])])]),t("q-card-actions",{staticClass:"q-mt-lg",attrs:{align:"center"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md q-mr-lg",attrs:{rounded:"",label:"Sair",color:"negative"}}),t("q-btn",{staticClass:"q-px-md",attrs:{label:"Salvar",color:"positive",rounded:""},on:{click:function(t){return a.handleSaveWhatsApp(a.whatsapp)}}})],1)],1)],1)},x=[],M=e("b5ae"),O=e("446a"),E=e("cdde"),N=e("2a19"),I=e("79b5"),A={components:{cInput:O["a"],VEmojiPicker:I["a"]},name:"ModalWhatsapp",props:{modalWhatsapp:{type:Boolean,default:!1},whatsAppId:{type:Number,default:null},whatsAppEdit:{type:Object,default:()=>{}}},data(){return{isPwd:!0,isEdit:!1,whatsapp:{name:"",isDefault:!1,tokenTelegram:"",instagramUser:"",instagramKey:"",tokenAPI:"",type:"whatsapp",farewellMessage:""},optionsWhatsappsTypes:[{label:"Whatsapp",value:"whatsapp"},{label:"Telegram",value:"telegram"}],variaveis:[{label:"Nome",value:"{{name}}"},{label:"Saudação",value:"{{greeting}}"},{label:"Protocolo",value:"{{protocol}}"}]}},validations:{whatsapp:{name:{required:M["required"],minLength:Object(M["minLength"])(3),maxLength:Object(M["maxLength"])(50)},isDefault:{}}},computed:{"cBaseUrlIntegração"(){return this.whatsapp.UrlMessengerWebHook}},methods:{onInsertSelectEmoji(a){const t=this;var e=this.$refs.inputFarewellMessage,s=e.selectionStart,i=e.selectionEnd,o=s,n=e.value;a.data&&(t.txtContent=this.whatsapp.farewellMessage,t.txtContent=n.substring(0,s)+a.data+n.substring(i,n.length),this.whatsapp.farewellMessage=t.txtContent,setTimeout((()=>{e.selectionStart=e.selectionEnd=o+a.data.length}),10))},copy(a){Object(E["a"])(a).then(this.$notificarSucesso("URL de integração copiada!")).catch()},onInsertSelectVariable(a){const t=this;var e=this.$refs.inputFarewellMessage,s=e.selectionStart,i=e.selectionEnd,o=s,n=e.value;a&&(t.txtContent=this.whatsapp.farewellMessage,t.txtContent=n.substring(0,s)+a+n.substring(i,n.length),this.whatsapp.farewellMessage=t.txtContent,setTimeout((()=>{e.selectionStart=e.selectionEnd=o+1}),10))},fecharModal(){this.whatsapp={name:"",isDefault:!1},this.$emit("update:whatsAppEdit",{}),this.$emit("update:modalWhatsapp",!1)},abrirModal(){this.whatsAppEdit.id&&(this.whatsapp={...this.whatsAppEdit})},async handleSaveWhatsApp(a){if(this.$v.whatsapp.$touch(),this.$v.whatsapp.$error)return this.$q.notify({type:"warning",progress:!0,position:"top",message:"Ops! Verifique os erros...",actions:[{icon:"close",round:!0,color:"white"}]});try{this.whatsAppEdit.id?await Object(o["g"])(this.whatsAppEdit.id,a):await Object(o["a"])(a),this.$q.notify({type:"positive",progress:!0,position:"top",message:`Whatsapp ${this.whatsAppEdit.id?"editado":"criado"} com sucesso!`,actions:[{icon:"close",round:!0,color:"white"}]}),this.$emit("recarregar-lista"),this.fecharModal()}catch(t){if(console.error(t,"ERR_NO_PERMISSION_CONNECTIONS_LIMIT"===t.data.error),"ERR_NO_PERMISSION_CONNECTIONS_LIMIT"!==t.data.error)return console.error(t),this.$q.notify({type:"error",progress:!0,position:"top",message:"Ops! Verifique os erros... O nome da conexão não pode existir na plataforma, é um identificador único.",actions:[{icon:"close",round:!0,color:"white"}]});N["a"].create({type:"negative",message:"Limite de conexões atingida.",caption:"ERR_NO_PERMISSION_CONNECTIONS_LIMIT",position:"top",progress:!0})}}},destroyed(){this.$v.whatsapp.$reset()}},k=A,W=e("0016"),$=e("ddd8"),T=e("05c0"),j=e("4e73"),D=e("1c1c"),R=e("66e5"),P=e("4074"),L=e("4b7e"),F=e("7f67"),z=Object(g["a"])(k,_,x,!1,null,"60765931",null),U=z.exports;C()(z,"components",{QDialog:b["a"],QCard:w["a"],QCardSection:f["a"],QIcon:W["a"],QSelect:$["a"],QBtn:v["a"],QTooltip:T["a"],QMenu:j["a"],QList:D["a"],QItem:R["a"],QItemSection:P["a"],QCardActions:L["a"]}),C()(z,"directives",{ClosePopup:F["a"]});var V=e("8039"),B=e("824a");const H=JSON.parse(localStorage.getItem("usuario"));var J={name:"IndexSessoesWhatsapp",components:{ModalQrCode:S,ModalWhatsapp:U,ItemStatusChannel:V["a"]},data(){return{userProfile:"user",loading:!1,userLogado:H,isAdmin:!1,abrirModalQR:!1,modalWhatsapp:!1,whatsappSelecionado:{},listaChatFlow:[],whatsAppId:null,canais:[],objStatus:{qrcode:""},columns:[{name:"name",label:"Nome",field:"name",align:"left"},{name:"status",label:"Status",field:"status",align:"center"},{name:"session",label:"Sessão",field:"status",align:"center"},{name:"number",label:"Número",field:"number",align:"center"},{name:"updatedAt",label:"Última Atualização",field:"updatedAt",align:"center",format:a=>this.formatarData(a,"dd/MM/yyyy HH:mm")},{name:"isDefault",label:"Padrão",field:"isDefault",align:"center"},{name:"acoes",label:"Ações",field:"acoes",align:"center"}]}},watch:{whatsapps:{handler(){this.canais=JSON.parse(JSON.stringify(this.whatsapps))},deep:!0}},computed:{...Object(Q["b"])(["whatsapps"]),cDadosWhatsappSelecionado(){const{id:a}=this.whatsappSelecionado;return this.whatsapps.find((t=>t.id===a))}},methods:{formatarData(a,t){return Object(n["a"])(Object(l["a"])(a),t,{locale:c.a})},handleOpenQrModal(a){this.whatsappSelecionado=a,this.abrirModalQR=!0},handleOpenModalWhatsapp(a){this.whatsappSelecionado=a,this.modalWhatsapp=!0},async handleDisconectWhatsSession(a){this.$q.dialog({title:"Atenção!! Deseja realmente desconectar? ",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(o["c"])(a).then((()=>{const t=this.whatsapps.find((t=>t.id===a));this.$store.commit("UPDATE_WHATSAPPS",{...t,status:"DISCONNECTED"})})).finally((a=>{this.loading=!1}))}))},async handleStartWhatsAppSession(a){try{await Object(o["f"])(a)}catch(t){console.error(t)}},async handleRequestNewQrCode(a,t){"telegram"!==a.type||a.tokenTelegram||this.$notificarErro("Necessário informar o token para Telegram"),this.loading=!0;try{await Object(o["e"])({id:a.id,isQrcode:!0}),setTimeout((()=>{this.handleOpenQrModal(a)}),2e3)}catch(e){console.error(e)}this.loading=!1},async listarWhatsapps(){const{data:a}=await Object(o["d"])();this.$store.commit("LOAD_WHATSAPPS",a)},async deleteWhatsapp(a){this.$q.dialog({title:"Atenção!! Deseja realmente deletar? ",message:"Não é uma boa ideia apagar se já tiver gerado atendimentos para esse whatsapp.",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(o["b"])(a.id).then((t=>{this.$store.commit("DELETE_WHATSAPPS",a.id)})).finally((a=>{this.loading=!1}))}))},async listarChatFlow(){const{data:a}=await Object(B["c"])();this.listaChatFlow=a.chatFlow},async handleSaveWhatsApp(a){try{await Object(o["g"])(a.id,a),this.$q.notify({type:"positive",progress:!0,position:"top",message:`Whatsapp ${a.id?"editado":"criado"} com sucesso!`,actions:[{icon:"close",round:!0,color:"white"}]})}catch(t){return console.error(t),this.$q.notify({type:"error",progress:!0,position:"top",message:"Ops! Verifique os erros... O nome da conexão não pode existir na plataforma, é um identificador único.",actions:[{icon:"close",round:!0,color:"white"}]})}}},mounted(){this.userProfile=localStorage.getItem("profile"),this.isAdmin=localStorage.getItem("profile"),this.listarWhatsapps(),this.listarChatFlow()}},G=J,K=e("cb32"),X=e("0170"),Y=e("eb85"),Z=e("9569"),aa=e("74f7"),ta=e("cf57"),ea=Object(g["a"])(G,s,i,!1,null,"4cbc4773",null);t["default"]=ea.exports;C()(ea,"components",{QCard:w["a"],QCardSection:f["a"],QBtn:v["a"],QItem:R["a"],QItemSection:P["a"],QAvatar:K["a"],QIcon:W["a"],QItemLabel:X["a"],QSeparator:Y["a"],QSelect:$["a"],QCardActions:L["a"],QSpinnerRadio:Z["a"],QTooltip:T["a"],QInnerLoading:aa["a"],QSpinnerGears:ta["a"]})}}]);