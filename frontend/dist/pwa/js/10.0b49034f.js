(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{"6fd6":function(t,a,e){"use strict";e("c411")},"8fbc":function(t,a,e){"use strict";e.r(a);e("14d9");var s=function(){var t=this,a=t._self._c;return"admin"===t.userProfile?a("div",[a("q-card",{staticClass:"q-ma-sm",attrs:{flat:""}},[a("q-card-section",[a("div",{staticClass:"row text-h6"},[t._v("\n        Campanha: "+t._s(t.$route.params.campanha.name)+"\n      ")]),a("div",{staticClass:"row text-caption"},[t._v("\n        Início: "+t._s(t.formatDate(t.$route.params.campanha.start))+" - Status: "+t._s(t.$route.params.campanha.status)+"\n      ")]),a("q-btn",{staticClass:"absolute-top-right q-ma-md",attrs:{rounded:"",icon:"mdi-arrow-left",label:"Listar Campanhas",color:"black"},on:{click:function(a){return t.$router.push({name:"campanhas"})}}})],1)],1),a("q-table",{staticClass:"my-sticky-dynamic q-ma-sm",attrs:{title:"Contatos",id:"tabela-contatos-campanha",data:t.contatosCampanha,columns:t.columns,loading:t.loading,"row-key":"id",pagination:t.pagination,"rows-per-page-options":[0],separator:"cell"},on:{"update:pagination":function(a){t.pagination=a}},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticClass:"row col-4 q-table__title items-center"},[t._v("\n        Contatos\n      ")]),a("q-space"),a("q-btn",{staticClass:"q-ml-md",attrs:{rounded:"",color:"black",icon:"refresh"},on:{click:t.listarContatosCampanha}},[a("q-tooltip",[t._v("\n          Atualizar Listagem\n        ")])],1),"pending"===t.$route.params.campanha.status||"canceled"===t.$route.params.campanha.status?a("q-btn",{staticClass:"q-ml-md",attrs:{color:"negative",icon:"close",outline:"",rounded:"",label:"Limpar Campanha"},on:{click:t.deletarTodosContatosCampanha}}):t._e(),"pending"===t.$route.params.campanha.status||"canceled"===t.$route.params.campanha.status?a("q-btn",{staticClass:"q-ml-md",attrs:{color:"primary",label:"Incluir Contatos",icon:"add",rounded:""},on:{click:function(a){t.modalAddContatosCampanha=!t.modalAddContatosCampanha}}}):t._e()]},proxy:!0},{key:"body-cell-profilePicUrl",fn:function(e){return[a("q-td",[a("q-avatar",{staticStyle:{border:"1px solid #9e9e9ea1 !important"}},[e.value?t._e():a("q-icon",{attrs:{name:"mdi-account",size:"1.5em",color:"grey-5"}}),a("q-img",{staticStyle:{"max-width":"150px"},attrs:{src:e.value},scopedSlots:t._u([{key:"error",fn:function(){return[a("q-icon",{attrs:{name:"mdi-account",size:"1.5em",color:"grey-5"}})]},proxy:!0}],null,!0)})],1)],1)]}},{key:"body-cell-acoes",fn:function(e){return[a("q-td",{staticClass:"text-center"},["pending"===t.$route.params.campanha.status?a("q-btn",{attrs:{flat:"",round:"",icon:"mdi-delete"},on:{click:function(a){return t.deletarContatoCampanha(e.row)}}}):t._e()],1)]}},{key:"pagination",fn:function({pagination:a}){return[t._v("\n      "+t._s(t.contatosCampanha.length)+"/"+t._s(a.rowsNumber)+"\n    ")]}}],null,!1,1028934681)}),a("q-dialog",{attrs:{persistent:""},model:{value:t.modalAddContatosCampanha,callback:function(a){t.modalAddContatosCampanha=a},expression:"modalAddContatosCampanha"}},[a("q-card",{staticStyle:{"min-width":"80vw",width:"80vw"}},[a("q-card-section",{staticClass:"q-pt-none q-pt-md"},[a("fieldset",{staticClass:"rounded-all"},[a("legend",{staticClass:"q-px-sm"},[t._v("Filtros (Data criação do contato)")]),a("div",{staticClass:"row q-gutter-md items-end"},[a("div",{staticClass:"col-grow"},[a("label",[t._v("Início")]),a("DatePick",{attrs:{dense:"",rounded:""},model:{value:t.pesquisa.startDate,callback:function(a){t.$set(t.pesquisa,"startDate",a)},expression:"pesquisa.startDate"}})],1),a("div",{staticClass:"col-grow"},[a("label",[t._v("Final")]),a("DatePick",{attrs:{dense:"",rounded:""},model:{value:t.pesquisa.endDate,callback:function(a){t.$set(t.pesquisa,"endDate",a)},expression:"pesquisa.endDate"}})],1),a("div",{staticClass:"col-xs-12 col-sm-4 grow text-center"},[a("q-select",{attrs:{label:"Estado (s)",dense:"",rounded:"",outlined:"",multiple:"",options:t.estadosBR,"use-chips":"","option-value":"sigla","option-label":"nome","emit-value":"","map-options":"","dropdown-icon":"add"},scopedSlots:t._u([{key:"option",fn:function({itemProps:e,itemEvents:s,opt:o,selected:n,toggleOption:i}){return[a("q-item",t._g(t._b({},"q-item",e,!1),s),[a("q-item-section",[a("q-item-label",{domProps:{innerHTML:t._s(o.nome)}})],1),a("q-item-section",{attrs:{side:""}},[a("q-checkbox",{attrs:{value:n},on:{input:function(t){return i(o)}}})],1)],1)]}},{key:"selected-item",fn:function({opt:t}){return[a("q-badge",{staticClass:"q-ma-xs text-body1",attrs:{dense:"",rounded:"",color:"grey-3","text-color":"primary",label:t.nome}})]}}],null,!1,1257534320),model:{value:t.pesquisa.ddds,callback:function(a){t.$set(t.pesquisa,"ddds",a)},expression:"pesquisa.ddds"}})],1),a("div",{staticClass:"col-xs-12 col-sm-4 grow text-center"},[a("q-select",{attrs:{outlined:"",label:"Etiqueta (a)",dense:"",rounded:"",multiple:"",options:t.etiquetas,"use-chips":"","option-value":"id","option-label":"tag","emit-value":"","map-options":"","dropdown-icon":"add"},scopedSlots:t._u([{key:"option",fn:function({itemProps:e,itemEvents:s,opt:o,selected:n,toggleOption:i}){return[a("q-item",t._g(t._b({},"q-item",e,!1),s),[a("q-item-section",[a("q-item-label",{domProps:{innerHTML:t._s(o.tag)}})],1),a("q-item-section",{attrs:{side:""}},[a("q-checkbox",{attrs:{value:n},on:{input:function(t){return i(o)}}})],1)],1)]}},{key:"selected-item",fn:function({opt:e}){return[a("q-chip",{staticClass:"q-ma-xs text-body1",attrs:{dense:"",rounded:"",color:"white","text-color":"primary"}},[a("q-icon",{staticClass:"q-mr-sm",style:`color: ${e.color}`,attrs:{name:"mdi-pound-box-outline",size:"28px"}}),t._v("\n                    "+t._s(e.tag)+"\n                  ")],1)]}}],null,!1,54012316),model:{value:t.pesquisa.tags,callback:function(a){t.$set(t.pesquisa,"tags",a)},expression:"pesquisa.tags"}})],1),a("div",{staticClass:"col-xs-12 col-sm-4 grow text-center"},[a("q-select",{attrs:{outlined:"",rounded:"",label:"Carteira",dense:"",multiple:"",options:t.usuarios,"use-chips":"","option-value":"id","option-label":"name","emit-value":"","map-options":"","dropdown-icon":"add"},scopedSlots:t._u([{key:"option",fn:function({itemProps:e,itemEvents:s,opt:o,selected:n,toggleOption:i}){return[a("q-item",t._g(t._b({},"q-item",e,!1),s),[a("q-item-section",[a("q-item-label",{domProps:{innerHTML:t._s(o.name)}})],1),a("q-item-section",{attrs:{side:""}},[a("q-checkbox",{attrs:{value:n},on:{input:function(t){return i(o)}}})],1)],1)]}}],null,!1,421373798),model:{value:t.pesquisa.wallets,callback:function(a){t.$set(t.pesquisa,"wallets",a)},expression:"pesquisa.wallets"}})],1),a("div",{staticClass:"col-xs-12 col-sm-4 grow text-center"},[a("q-input",{staticStyle:{width:"300px"},attrs:{outlined:"",dense:"",rounded:"",clearable:"",placeholder:"Filtrar Nome ou Telefone"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!1,2901929698),model:{value:t.pesquisa.searchParam,callback:function(a){t.$set(t.pesquisa,"searchParam",a)},expression:"pesquisa.searchParam"}})],1),a("div",{staticClass:"col-grow text-right"},[a("q-btn",{staticClass:"q-mr-sm",attrs:{color:"primary",rounded:"",label:"Gerar",icon:"refresh"},on:{click:t.listarAddContatos}})],1)])])]),a("q-card-section",[a("q-table",{staticClass:"my-sticky-dynamic q-ma-sm",staticStyle:{height:"50vh"},attrs:{title:"Contatos",id:"tabela-contatos-campanha",data:t.contatosAdd,columns:t.columnsAdd,loading:t.loading,"row-key":"number",selection:"multiple",selected:t.selected,pagination:t.pagination,"rows-per-page-options":[0],separator:"cell"},on:{"update:selected":function(a){t.selected=a},"update:pagination":function(a){t.pagination=a}},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticClass:"row col-4 q-table__title items-center"},[t._v("\n              Selecionar Contatos\n            ")]),a("q-space"),a("q-btn",{staticClass:"q-ml-md",attrs:{rounded:"",color:"negative",label:"Cancelar"},on:{click:function(a){t.modalAddContatosCampanha=!1}}}),a("q-btn",{staticClass:"q-ml-md",attrs:{rounded:"",color:"positive",icon:"save",label:"Adicionar"},on:{click:t.addContatosCampanha}})]},proxy:!0},{key:"body-cell-profilePicUrl",fn:function(e){return[a("q-td",[a("q-avatar",{staticStyle:{border:"1px solid #9e9e9ea1 !important"}},[e.value?t._e():a("q-icon",{attrs:{name:"mdi-account",size:"1.5em",color:"grey-5"}}),a("q-img",{staticStyle:{"max-width":"150px"},attrs:{src:e.value},scopedSlots:t._u([{key:"error",fn:function(){return[a("q-icon",{attrs:{name:"mdi-account",size:"1.5em",color:"grey-5"}})]},proxy:!0}],null,!0)})],1)],1)]}}],null,!1,2454647040)})],1)],1)],1)],1):t._e()},o=[],n=e("163e"),i=e("c9d9"),l=e("ab52"),r=e("5f1d"),c=e("b166"),d=e("ef06"),m=e("e3ee"),p=e("9a1b"),u={name:"ContatosCampanha",data(){return{userProfile:"user",modalAddContatosCampanha:!1,etiquetas:[],usuarios:[],pesquisa:{startDate:Object(c["a"])(Object(d["a"])(new Date,{days:30}),"yyyy-MM-dd"),endDate:Object(c["a"])(new Date,"yyyy-MM-dd"),ddds:[],tags:[],wallets:[],searchParam:""},estadoPorDdd:i["a"],estadosBR:i["b"],contatosCampanha:[],filter:null,pagination:{rowsPerPage:40,rowsNumber:0,lastIndex:0},ACK:{"-1":"Error",0:"Envio Pendente",1:"Entrega Pendente",2:"Recebida",3:"Lida",4:"Reproduzido"},loading:!1,columns:[{name:"profilePicUrl",label:"",field:"profilePicUrl",style:"width: 50px",align:"center"},{name:"name",label:"Nome",field:"name",align:"left",style:"width: 300px"},{name:"number",label:"WhatsApp",field:"number",align:"center",style:"width: 300px"},{name:"campaignContacts",label:"Status",field:"campaignContacts",align:"center",style:"width: 200px",format:t=>t?this.ACK[t[0].ack]:""},{name:"tags",label:"Etiquetas",field:"tags",style:"width: 500px",align:"left",format:t=>{if(t){const a=t.map((t=>t.tag));return a.join(", ")}return""}},{name:"estado",label:"Estado",field:"number",style:"width: 500px",align:"left",format:t=>this.definirEstadoNumero(t)},{name:"acoes",label:"Ações",field:"acoes",align:"center"}],columnsAdd:[{name:"profilePicUrl",label:"",field:"profilePicUrl",style:"width: 50px",align:"center"},{name:"name",label:"Nome",field:"name",align:"left",style:"width: 300px"},{name:"number",label:"WhatsApp",field:"number",align:"center",style:"width: 300px"},{name:"tags",label:"Etiquetas",field:"tags",style:"width: 500px",align:"left",format:t=>{if(t){const a=t.map((t=>t.tag));return a.join(", ")}return""}},{name:"estado",label:"Estado",field:"number",style:"width: 500px",align:"left",format:t=>this.definirEstadoNumero(t)}],contatosAdd:[],selected:[]}},methods:{formatDate(t,a="dd/MM/yyyy"){return Object(c["a"])(Object(m["a"])(t),a)},async listarAddContatos(){console.log(this.pesquisa);const{data:t}=await Object(l["h"])(this.pesquisa);this.pesquisa.tags.length>0?this.contatosAdd=t.contacts.filter((t=>this.pesquisa.tags.every((a=>t.tags.map((t=>t.id)).includes(a))))):this.contatosAdd=t.contacts},async listarEtiquetas(){const{data:t}=await Object(n["d"])(!0);this.etiquetas=t},async listarContatosCampanha(){const{data:t}=await Object(r["j"])(this.$route.params.campanhaId);this.contatosCampanha=t},definirEstadoNumero(t){var a;const e=t.substring(2,4);return(null===(a=i["b"].find((t=>t.sigla===i["a"][e])))||void 0===a?void 0:a.nome)||""},async addContatosCampanha(){if(this.selected.length>300)this.$q.notify({type:"negative",message:"O número máximo de contatos é 300"});else try{await Object(r["a"])(this.selected,this.$route.params.campanhaId),this.listarContatosCampanha(),this.modalAddContatosCampanha=!1,this.$q.notify({type:"positive",progress:!0,position:"top",message:"Contatos adicionados.",actions:[{icon:"close",round:!0,color:"white"}]})}catch(t){console.error(t),this.$notificarErro("Ocorreu um erro!",t)}},async listarUsuarios(){try{const{data:t}=await Object(p["f"])();this.usuarios=t.users}catch(t){console.error(t),this.$notificarErro("Problema ao carregar usuários",t)}},deletarContatoCampanha(t){Object(r["f"])(this.$route.params.campanhaId,t.id).then((t=>{this.listarContatosCampanha(),this.$q.notify({type:"positive",progress:!0,position:"top",message:"Contato excluído desta campanha",actions:[{icon:"close",round:!0,color:"white"}]})})).catch((t=>{console.error(t),this.$notificarErro("Verifique os erros...",t)}))},deletarTodosContatosCampanha(){this.$q.dialog({title:"Atenção!! Deseja realmente retirar todos os contatos desta campanha? ",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{Object(r["g"])(this.$route.params.campanhaId).then((t=>{this.contatosCampanha=[],this.$notificarSucesso("Contato excluído desta campanha")})).catch((t=>{console.error(t),this.$notificarErro("Não foi possível excluir o contato da campanha",t)}))}))}},beforeMount(){this.listarEtiquetas(),this.listarUsuarios()},mounted(){this.userProfile=localStorage.getItem("profile");const t=this.$route.params.campanha;t?this.listarContatosCampanha():this.$router.push({name:"campanhas"})}},h=u,f=(e("6fd6"),e("2877")),b=e("f09f"),q=e("a370"),g=e("9c40"),C=e("eaac"),y=e("2c91"),v=e("05c0"),w=e("db86"),x=e("cb32"),k=e("0016"),_=e("068f"),$=e("24e8"),P=e("ddd8"),A=e("66e5"),S=e("4074"),E=e("0170"),O=e("8f8e"),Q=e("58a8"),D=e("b047"),j=e("27f9"),I=e("eebe"),M=e.n(I),N=Object(f["a"])(h,s,o,!1,null,null,null);a["default"]=N.exports;M()(N,"components",{QCard:b["a"],QCardSection:q["a"],QBtn:g["a"],QTable:C["a"],QSpace:y["a"],QTooltip:v["a"],QTd:w["a"],QAvatar:x["a"],QIcon:k["a"],QImg:_["a"],QDialog:$["a"],QSelect:P["a"],QItem:A["a"],QItemSection:S["a"],QItemLabel:E["a"],QCheckbox:O["a"],QBadge:Q["a"],QChip:D["a"],QInput:j["a"]})},c411:function(t,a,e){}}]);