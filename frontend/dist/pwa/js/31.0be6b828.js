(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[31],{"9bad":function(a,i,o){"use strict";o.r(i);var s=function(){var a=this,i=a._self._c;return"admin"===a.userProfile?i("div",[i("q-table",{staticClass:"my-sticky-dynamic q-ma-lg",attrs:{title:"Usuarios",data:a.usuarios,columns:a.columns,loading:a.loading,"row-key":"id",pagination:a.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(i){a.pagination=i}},scopedSlots:a._u([{key:"top-right",fn:function(){return[i("q-input",{staticClass:"col-grow",staticStyle:{width:"300px"},attrs:{outlined:"",rounded:"",dense:"",debounce:"500",clearable:"",placeholder:"Localize"},on:{input:a.filtrarUsuario},scopedSlots:a._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!1,2901929698),model:{value:a.filter,callback:function(i){a.filter=i},expression:"filter"}}),i("q-space"),i("q-btn",{staticClass:"q-ml-md col",class:{"q-ml-none q-mt-md q-mr-md":a.$q.screen.width<500},attrs:{rounded:"",color:"primary",label:"Adicionar"},on:{click:function(i){a.usuarioSelecionado={},a.modalUsuario=!0}}})]},proxy:!0},{key:"body-cell-acoes",fn:function(o){return[i("q-td",{staticClass:"text-center"},[i("q-btn",{attrs:{flat:"",round:"",icon:"mdi-arrow-decision-outline"},on:{click:function(i){return a.gerirFilasUsuario(o.row)}}},[i("q-tooltip",[a._v("\n            Gestão de Filas do usuário\n          ")])],1),i("q-btn",{attrs:{flat:"",round:"",icon:"edit"},on:{click:function(i){return a.editarUsuario(o.row)}}}),i("q-btn",{attrs:{flat:"",round:"",icon:"mdi-delete"},on:{click:function(i){return a.deletarUsuario(o.row)}}})],1)]}},{key:"pagination",fn:function({pagination:i}){return[a._v("\n      "+a._s(a.usuarios.length)+"/"+a._s(i.rowsNumber)+"\n    ")]}}],null,!1,1716728654)}),i("ModalUsuario",{attrs:{modalUsuario:a.modalUsuario,usuarioEdicao:a.usuarioSelecionado},on:{"update:modalUsuario":function(i){a.modalUsuario=i},"update:modal-usuario":function(i){a.modalUsuario=i},"modalUsuario:usuario-editado":a.UPDATE_USUARIO,"modalUsuario:usuario-criado":a.usuarioCriado,"update:usuarioEdicao":function(i){a.usuarioSelecionado=i},"update:usuario-edicao":function(i){a.usuarioSelecionado=i}}}),i("ModalFilaUsuario",{attrs:{modalFilaUsuario:a.modalFilaUsuario,usuarioSelecionado:a.usuarioSelecionado,filas:a.filas},on:{"update:modalFilaUsuario":function(i){a.modalFilaUsuario=i},"update:modal-fila-usuario":function(i){a.modalFilaUsuario=i},"update:usuarioSelecionado":function(i){a.usuarioSelecionado=i},"update:usuario-selecionado":function(i){a.usuarioSelecionado=i},"modalFilaUsuario:sucesso":a.UPDATE_USUARIO}})],1):a._e()},e=[],t=(o("14d9"),o("9a1b")),r=o("ee0e"),l=o("25c4"),u=function(){var a=this,i=a._self._c;return i("q-dialog",{attrs:{persistent:"",value:a.modalFilaUsuario},on:{hide:a.fecharModal,show:a.abrirModal}},[i("q-card",{staticStyle:{width:"400px"}},[i("q-card-section",{staticClass:"q-pa-none"},[i("div",{staticClass:"full-width text-h6 row col bg-grey-4 q-pa-sm"},[a._v("Filas Usuário")]),i("div",{staticClass:"text-caption text-bold row col q-px-sm q-pt-sm",staticStyle:{"font-size":"1em"}},[a._v("Nome: "+a._s(a.usuarioSelecionado.name))]),i("div",{staticClass:"text-caption text-bold row col q-px-sm",staticStyle:{"font-size":"1em"}},[a._v("Email: "+a._s(a.usuarioSelecionado.email))]),i("q-separator",{attrs:{spaced:""}})],1),i("q-card-section",[a._l(a.filas,(function(o){return[i("div",{key:o.id,staticClass:"row col"},[i("q-checkbox",{attrs:{disable:!o.isActive,label:`${o.queue} ${o.isActive?"":"(Inativo)"}`,val:o.id},model:{value:a.filasUsuario,callback:function(i){a.filasUsuario=i},expression:"filasUsuario"}})],1)]}))],2),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md q-mr-sm",attrs:{label:"Sair",color:"negative",rounded:""}}),i("q-btn",{staticClass:"q-px-md",attrs:{label:"Salvar",color:"primary",rounded:""},on:{click:a.handleFilaUsuario}})],1)],1)],1)},n=[],d={name:"ModalFilaUsuario",props:{modalFilaUsuario:{type:Boolean,default:!1},usuarioSelecionado:{type:Object,default:()=>({id:null})},filas:{type:Array,default:()=>[]}},data(){return{filasUsuario:[]}},methods:{abrirModal(){this.usuarioSelecionado.id&&(this.filasUsuario=[...this.usuarioSelecionado.queues.map((a=>a.id))])},fecharModal(){this.$emit("update:usuarioSelecionado",{}),this.$emit("update:modalFilaUsuario",!1)},async handleFilaUsuario(){const a={...this.usuarioSelecionado,queues:[...this.filasUsuario]},{data:i}=await Object(t["h"])(a.id,a);this.$emit("modalFilaUsuario:sucesso",i),this.$q.notify({type:"positive",progress:!0,position:"top",message:"Filas do usuário editadas com sucesso!",actions:[{icon:"close",round:!0,color:"white"}]}),this.fecharModal()}}},c=d,p=o("2877"),m=o("24e8"),f=o("f09f"),h=o("a370"),U=o("eb85"),b=o("8f8e"),g=o("4b7e"),q=o("9c40"),S=o("7f67"),w=o("eebe"),v=o.n(w),y=Object(p["a"])(c,u,n,!1,null,"735bdec0",null),x=y.exports;v()(y,"components",{QDialog:m["a"],QCard:f["a"],QCardSection:h["a"],QSeparator:U["a"],QCheckbox:b["a"],QCardActions:g["a"],QBtn:q["a"]}),v()(y,"directives",{ClosePopup:S["a"]});var F={name:"IndexUsuarios",components:{ModalUsuario:l["a"],ModalFilaUsuario:x},data(){return{userProfile:"user",usuarios:[],usuarioSelecionado:{},modalFilaUsuario:!1,filas:[],optionsProfile:[{value:"user",label:"Usuário"},{value:"admin",label:"Administrador"}],modalUsuario:!1,filter:null,pagination:{rowsPerPage:40,rowsNumber:0,lastIndex:0},params:{pageNumber:1,searchParam:null,hasMore:!0},loading:!1,columns:[{name:"name",label:"Nome",field:"name",align:"left"},{name:"email",label:"E-mail",field:"email",align:"left"},{name:"queues",label:"Filas",field:"queues",align:"left",format:a=>a?a.map((a=>a.queue)).join(", "):"",classes:"ellipsis",style:"max-width: 400px;"},{name:"profile",label:"Perfil",field:"profile",align:"left",format:a=>this.optionsProfile.find((i=>i.value==a)).label},{name:"acoes",label:"Ações",field:"acoes",align:"center"}]}},methods:{LOAD_USUARIOS(a){const i=[];a.forEach((a=>{const o=this.usuarios.findIndex((i=>i.id===a.id));-1!==o?this.usuarios[o]=a:i.push(a)}));const o=[...this.usuarios,...i];this.usuarios=o.filter((a=>"super"!==a.profile))},UPDATE_USUARIO(a){let i=[...this.usuarios];const o=i.findIndex((i=>i.id===a.id));-1!==o?i[o]=a:i=[a,...i],this.usuarios=[...i]},DELETE_USUARIO(a){const i=[...this.usuarios.filter((i=>i.id!==a))];this.usuarios=[...i]},async listarUsuarios(){this.loading=!0;const{data:a}=await Object(t["f"])(this.params);this.usuarios=a.users,this.LOAD_USUARIOS(a.users),this.params.hasMore=a.hasMore,this.pagination.lastIndex=this.usuarios.length-1,this.pagination.rowsNumber=a.count,this.loading=!1},filtrarUsuario(a){this.usuarios=[],this.params.pageNumber=1,this.params.searchParam=a,this.listarUsuarios()},onScroll({to:a,ref:i,...o}){!0!==this.loading&&!0===this.params.hasMore&&a===this.pagination.lastIndex&&(this.params.pageNumber++,this.listarUsuarios())},usuarioCriado(a){const i=[...this.usuarios];i.push(a),this.usuarios=[...i]},editarUsuario(a){this.usuarioSelecionado=a,this.modalUsuario=!0},deletarUsuario(a){this.$q.dialog({title:`Atenção!! Deseja realmente deletar o usuario "${a.name}"?`,cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(t["e"])(a.id).then((i=>{this.DELETE_USUARIO(a.id),this.$q.notify({type:"positive",progress:!0,position:"top",message:`Usuario ${a.name} deletado!`,actions:[{icon:"close",round:!0,color:"white"}]})})).catch((a=>{console.error(a),this.$notificarErro("Não é possível deletar o usuário",a)})),this.loading=!1}))},async listarFilas(){const{data:a}=await Object(r["d"])();this.filas=a},gerirFilasUsuario(a){this.usuarioSelecionado=a,this.modalFilaUsuario=!0}},async mounted(){this.userProfile=localStorage.getItem("profile"),await this.listarFilas(),await this.listarUsuarios()}},_=F,k=o("eaac"),A=o("27f9"),C=o("0016"),I=o("2c91"),O=o("db86"),E=o("05c0"),M=Object(p["a"])(_,s,e,!1,null,"36c799e8",null);i["default"]=M.exports;v()(M,"components",{QTable:k["a"],QInput:A["a"],QIcon:C["a"],QSpace:I["a"],QBtn:q["a"],QTd:O["a"],QTooltip:E["a"]})}}]);